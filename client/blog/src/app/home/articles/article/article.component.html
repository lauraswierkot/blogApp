<mat-card class="container">
  <mat-card-header>
    <mat-card-title class="container__form__field">{{ selectedArticle?.title }}</mat-card-title>
    <mat-card-subtitle class="container__form__field">{{ selectedArticle?.description }}</mat-card-subtitle>
  </mat-card-header>
  <img [src]="fileSource" width="300" height="150">
  <mat-card-content>
    <div class="container__form__field">
      {{ selectedArticle?.body }}
    </div>
    <div class="container__form__field">
      <mat-chip-list #chipList>
        <mat-chip *ngFor="let tag of selectedArticle?.tagList">
          {{ tag }}
        </mat-chip>
      </mat-chip-list>
    </div>
  </mat-card-content>
  <div *ngIf="selectedArticle?.comments">
    <h3 class="container__form--title">{{ 'article.commentsTitle' | translate }}</h3>
    <!-- <div *ngFor="let comment of selectedArticle?.comments">
      <p>
        {{ comment.body | slice: commentIndex : commentMaxLength }}
        <span *ngIf="comment.body.length >=commentMaxLength">...</span>
        <span *ngIf="comment.author; else anonymousComment">{{ comment.author?.username }}</span>
        <ng-template #anonymousComment>
          {{ 'articleForm.anonymous' | translate }}
        </ng-template>
        {{ comment.createdAt | date: 'short' }}
        <button mat-raised-button *ngIf="comment.author.username === (user$ | async).username"
          (click)="openDialog(comment)">
          Edit
        </button>
      </p>
    </div> -->
    <div [formGroup]="editCommentsForm">
      <ng-container formArrayName="comments">
        <ng-container *ngFor="let comment of comments; let i = index">
          <div class="lesson-form-row" [formGroup]="comment">
            <ng-container *ngIf="comment.value.author ==  (user$ | async).username else noCommentUpdate">
              <input type="text" formControlName="body" />
              <button type="submit"  (click)="saveUpdatedComment(i)"> save</button>    
            </ng-container>
            <ng-template #noCommentUpdate>
              {{comment.value.body}}
            </ng-template>
          </div>
        </ng-container>
      </ng-container>
    </div>
  </div>
  <mat-card-actions>
    <div class="container__form__field">
      <span>{{ 'article.toArticles' | translate }}</span>
      <span (click)="toArticles()" class="material-icons container__form__field--icons arrow">trending_flat</span>
    </div>
  </mat-card-actions>
</mat-card>

<form class="container__form" [formGroup]="createCommentForm" (ngSubmit)="submitCreateCommentForm()">
  <h1>{{ 'comment.title' | translate }}</h1>
  <div>
    <div>
      <textarea formControlName="body" name="body" type="text" required></textarea>
    </div>
  </div>
  <div>
    <button type="submit" cdkFocusInitial>{{ 'comment.save' | translate }}</button>
  </div>
</form>